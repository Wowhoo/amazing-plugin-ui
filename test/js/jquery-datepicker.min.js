/*! Datepicker - v0.3.0 - 2014-02-08
* https://github.com/amazingsurge/jquery-datepicker
* Copyright (c) 2014 amazingSurge; Licensed MIT */
(function(e){var t=e.datepicker=function(s,a){this.$el=e(s);var i=[],n=this;e.each(this.$el.data(),function(e,t){i[e]=n._parseHtmlString(e,t)}),this.options=e.extend(!0,{},t.defaults,a,i),this._init()},s=e(document),a={},i=0;t.defaults={firstDayOfWeek:0,mode:"single",rangeMode:"default",displayMode:"dropdown",calendars:3,date:"today",keyboard:!0,rangeSeparator:"-",multipleSeparator:",",multipleSelectNum:5,max:null,min:null,position:"bottom",alwaysShow:!1,onceClick:!1,selectableYear:[],selectableMonth:[],selectableDay:[],selectableDate:[],disableYear:[],disableMonth:[],disableDay:[],disableDate:[],lang:"en",views:["days"],format:"yyyy/mm/dd",namespace:"calendar",tplWrapper:function(){return'<div class="namespace-wrap"></div>'},tplContent:function(){return'<div class="namespace-content"><div class="namespace-header"><span class="namespace-prev"></span><span class="namespace-caption"></span><span class="namespace-next"></span></div><div class="namespace-days"></div><div class="namespace-months"></div><div class="namespace-years"></div></div>'},localize:function(e,t){a[e]=t},onRender:function(){},onChange:function(){},onBeforeShow:function(){},onShow:function(){},onBeforeHide:function(){},onHide:function(){}},t.defaults.localize("en",{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),t.defaults.localize("zh",{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"]}),t.prototype={constructor:t,_keyboard:{init:function(e){this.attach(e,this.gather(e))},destroy:function(e){"dropdown"===e.options.displayMode?e.$el.off("keydown.dropdown"):e.picker.off("keydown.inline"),e.bound=!1},keys:function(){return{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27,CTRL:17,ALT:18}},prevDate:function(){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()-1),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()-1)?this.prev(e,!0):this._manageViews(e);break;case"months":t.setMonth(t.getMonth()-1),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()-1)?this.prev(e):this._manageViews(e);break;case"years":t.setFullYear(t.getFullYear()-1),t.getFullYear()===this.currentYear[e]-8?this.prev(e):this._manageViews(e)}},nextDate:function(){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()+1),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()+1)?this.next(e,!0):this._manageViews(e);break;case"months":t.setMonth(t.getMonth()+1),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()+1)?this.next(e):this._manageViews(e);break;case"years":t.setFullYear(t.getFullYear()+1),t.getFullYear()===this.currentYear[e]+5?this.next(e):this._manageViews(e)}},upLine:function(){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()-7),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()-1)?this.prev(e,!0):this._manageViews(e);break;case"months":t.setMonth(t.getMonth()-3),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()-1)?this.prev(e):this._manageViews(e);break;case"years":t.setFullYear(t.getFullYear()-3),t.getFullYear()<=this.currentYear[e]-8?this.prev(e):this._manageViews(e)}},downLine:function(){var e=this.focused,t="multiple"===this.mode?this.focusDate:this.focusDate[e];switch(this.views[e]){case"days":t.setDate(t.getDate()+7),new Date(t).setDate(1)===new Date(this.currentMonthDate[e]).setMonth(this.currentDate[e].getMonth()+1)?this.next(e,!0):this._manageViews(e);break;case"months":t.setMonth(t.getMonth()+3),Date.parse(new Date(t.getFullYear(),0,1,0,0,0,0))===new Date(this.currentYearDate[e]).setFullYear(this.currentDate[e].getFullYear()+1)?this.next(e):this._manageViews(e);break;case"years":t.setFullYear(t.getFullYear()+3),t.getFullYear()>=this.currentYear[e]+5?this.next(e):this._manageViews(e)}},prevPage:function(){if("multiple"===this.mode)this.prev(this.focused);else{if(this.calendarPrevs.eq(this.focused).hasClass(this.namespace+"-blocked"))return!1;this.prev(this.focused,!0)}},nextPage:function(){if("multiple"===this.mode)this.next(this.focused);else{if(this.calendarNexts.eq(this.focused).hasClass(this.namespace+"-blocked"))return!1;this.next(this.focused,!0)}},higherView:function(){if("multiple"===this.mode)return!1;var e=this.focused;this._changeView("higher",e),this._manageViews(e)},lowerView:function(){if("multiple"===this.mode)return!1;var e=this.focused;this._changeView("lower",e),this._manageViews(e)},prevCalendar:function(){if("multiple"===this.mode)return!1;var e=this.calendars.length;0>--this.focused&&(this.focused=e)},nextCalendar:function(){if("multiple"===this.mode)return!1;var e=this.calendars.length;++this.focused>=e&&(this.focused=0)},updateValue:function(t){var s=t.focused,a="multiple"===t.mode?t.focusDate:t.focusDate[s];if(t.calendars.eq(s).find("."+this.namespace+"_focus").hasClass(this.namespace+"_untouchable"))return!1;switch(t.views[s]){case"days":switch(t.options.mode){case"single":case"range":t.selectedDate[s]=new Date(a);break;case"multiple":var i=Date.parse(new Date(a));e.inArray(i,t.selectedDate)>-1?e.each(t.selectedDate,function(e,s){return s===i?(t.selectedDate.splice(e,1),!1):void 0}):t.selectedDate.push(i)}break;case"months":t.currentDate[s].setMonth(a.getMonth()),t.views[s]="days";break;case"years":t.currentDate[s].setFullYear(a.getFullYear()),t.views[s]="months"}t._updateDate(s),"range"===t.mode?(t._manageViews(0),t._manageViews(1)):"multiple"===t.mode?(t._manageViews(s-1),t._manageViews(s),t._manageViews(s+1)):t._manageViews(s),t._setValue()},enter:function(){var t,s=this.$el.val(),a=this;if(s===this.oldValue||""===this.oldValue)this._keyboard.updateValue(this);else{var i;switch(this.mode){case"single":var n=Date.parse(s);n&&(this.selectedDate[0]=new Date(n),this.currentDate[0]=new Date(this.selectedDate[0]),this._updateDate(0),this._manageViews(0));break;case"range":i=this._stringSeparate(s,this.options.rangeSeparator);var r=Date.parse(i[0]),h=Date.parse(i[1]);if(2===i.length?(t=!0,r&&h?r>h&&(t=!1):t=!1):t=!1,t===!0){this.selectedDate[0]=new Date(r),this.selectedDate[1]=new Date(h);for(var o=0;2>o;o++)this.currentDate[o]=new Date(this.selectedDate[o]),this._updateDate(o),this._manageViews(o)}else this._keyboard.updateValue(this);break;case"multiple":i=this._stringSeparate(s,this.options.multipleSeparator);var c=[];t=!0;for(var l=0;i.length>l;l++){var n=Date.parse(i[l]);c.push(n),Date.parse(i[l])||(t=!1)}if(t===!0){this.selectedDate=[];for(var u=0;c.length>u;u++)e.inArray(c[u],this.selectedDate)>-1?e.each(this.selectedDate,function(e,t){return t===c[u]?(a.selectedDate.splice(e,1),!1):void 0}):this.selectedDate.push(c[u]);for(var p=0;this.options.calendars>p;p++)this._updateDate(p),this._manageViews(p)}else this._keyboard.updateValue(this)}}this._setValue()},esc:function(){this.$el.blur(),this.hide()},tab:function(){this.pickerHide=!0},gather:function(t){return{left:e.proxy(this.prevDate,t),up:e.proxy(this.upLine,t),right:e.proxy(this.nextDate,t),down:e.proxy(this.downLine,t),ctrl_left:e.proxy(this.prevPage,t),ctrl_up:e.proxy(this.higherView,t),ctrl_right:e.proxy(this.nextPage,t),ctrl_down:e.proxy(this.lowerView,t),alt_left:e.proxy(this.prevCalendar,t),alt_right:e.proxy(this.nextCalendar,t),enter:e.proxy(this.enter,t),esc:e.proxy(this.esc,t)}},press:function(e){var t,s=e.keyCode||e.which;return e.ctrlKey?(e.preventDefault(),t=this.map[17]):e.altKey?(e.preventDefault(),t=this.map[18]):t=this.map,9===s&&this._keyboard.tab.call(this),s in t&&"function"==typeof t[s]?(e.preventDefault(),t[s].call(this)):void 0},attach:function(e,t){var s,a=this;for(s in t)if(t.hasOwnProperty(s)){var i=[],n=e._stringSeparate(s,"_"),r=n.length;if(1===r)i[0]=n[0].toUpperCase(),e.map[this.keys()[i[0]]]=t[s];else for(var h=0;n.length>h;h++)i[h]=n[h].toUpperCase(),0===h?void 0===e.map[this.keys()[i[0]]]&&(e.map[this.keys()[i[0]]]={}):e.map[this.keys()[i[0]]][this.keys()[i[h]]]=t[s]}e.bound||(e.bound=!0,"dropdown"===e.options.displayMode?e.$el.on("keydown.dropdown",function(t){a.press.call(e,t)}):e.picker.on("keydown.inline",function(t){a.press.call(e,t)}))}},_init:function(){this.format=this._parseFormat("yyyy-mm-dd"),this.outputFormat=this._parseFormat(this.options.format||"yyyy/mm/dd"),this.mode=this.options.mode,this.namespace=this.options.namespace,this.focused=0,this.map={},this.pickerHide=!1,this.flag=i++,this.selected=!1,this.showed=!1,this.bound=!1;var t,s=this.options.tplWrapper().replace(/namespace/g,this.namespace),a=this.options.tplContent().replace(/namespace/g,this.namespace),n=e(s);switch(this.mode){case"single":t=1;break;case"range":t=2;break;case"multiple":t=this.options.calendars,this.options.views=["days"]}this.options.calendars=t;for(var r=0;this.options.calendars>r;r++)n.append(a),this.options.views[r]=this.options.views[r]||"days";n.attr("tabindex","0"),"inline"===this.options.displayMode?(this.$el.after(n).addClass(this.namespace+"_hide"),this.picker=n,this.options.alwaysShow=!0,this.picker.addClass(this.namespace+"_show"),this.picker.on({focus:e.proxy(this._focus,this),blur:e.proxy(this._blur,this)})):"dropdown"===this.options.displayMode&&(this.$el.on({focus:e.proxy(this._focus,this),blur:e.proxy(this._blur,this)}),this.picker=n.appendTo("body"),this.picker.addClass(this.namespace+"_absolute")),this.views=this.options.views,this.calendars=this.picker.find("."+this.namespace+"-content"),this.calendarPrevs=this.calendars.find("."+this.namespace+"-prev"),this.calendarCaptions=this.calendars.find("."+this.namespace+"-caption"),this.calendarNexts=this.calendars.find("."+this.namespace+"-next"),this.daypickers=this.calendars.find("."+this.namespace+"-days"),this.monthpickers=this.calendars.find("."+this.namespace+"-months"),this.yearpickers=this.calendars.find("."+this.namespace+"-years"),this._initDate();for(var h=0;this.options.calendars>h;h++)this._manageViews(h);this.options.alwaysShow===!0?this.show():(this.showed=!0,this.hide()),this._setValue()},_initDate:function(){var e="today"===this.options.data?new Date:this._parseDate(this.options.date,this.format);this.currentDate=[new Date(e)],"multiple"===this.mode?(this.selectedDate=[],this.focusDate=new Date(e)):(this.selectedDate=[new Date(e)],this.focusDate=[new Date(e)]),this.currentDay=[],this.currentMonth=[],this.currentYear=[],this.currentMonthDate=[],this.currentYearDate=[],this.selectedDay=[],this.selectedMonth=[],this.selectedYear=[],this.selectedMonthDate=[],this.selectedYearDate=[],null!==this.options.max&&(this.maxDate=this._parseDate(this.options.max,this.format),this.maxMonth=this.maxDate.getMonth(),this.maxYear=this.maxDate.getFullYear()),null!==this.options.min&&(this.minDate=this._parseDate(this.options.min,this.format),this.minMonth=this.minDate.getMonth(),this.minYear=this.minDate.getFullYear());for(var t=0;this.options.calendars>t;t++)this.currentDate[t]=this.currentDate[t]||new Date(e),"multiple"===this.mode?this._setDate(this.currentDate[t],"month",this.currentDate[t].getMonth()+t):(this.selectedDate[t]=this.selectedDate[t]||new Date(e),this.selectedDate[t].setHours(0,0,0,0),this.focusDate[t]=this.focusDate[t]||new Date(e),this.focusDate[t].setHours(0,0,0,0)),this._updateDate(t);switch(this.selectableDate=this.options.selectableDate.length>0?!0:!1,this.disableDate=this.options.disableDate.length>0?!0:!1,this.yearSelectable=this.options.selectableYear.length>0?!0:!1,this.monthSelectable=this.options.selectableMonth.length>0?!0:!1,this.daySelectable=this.options.selectableDay.length>0?!0:!1,this.yearDisable=this.options.disableYear.length>0?!0:!1,this.monthDisable=this.options.disableMonth.length>0?!0:!1,this.dayDisable=this.options.disableDay.length>0?!0:!1,this.options.rangeMode){case"section":this.options.selectableYear.length>0&&(this.selectableYear=!0),this.yearSection=this.yearSelectable===!0?this._parseAble(this.options.selectableYear):this.yearDisable===!0?this._parseAble(this.options.disableYear):null,this.monthSection=this.monthSelectable===!0?this._parseAble(this.options.selectableMonth):this.monthDisable===!0?this._parseAble(this.options.disableMonth):null,this.daySection=this.daySelectable===!0?this._parseAble(this.options.selectableDay):this.dayDisable===!0?this._parseAble(this.options.disableDay):null;break;case"array":this.arrayRange=this.selectableDate===!0?this._parseAbleDate(this.options.selectableDate,this.format):this.disableDate===!0?this._parseAbleDate(this.options.disableDate,this.format):null,this.arrayRangeMonth=this._changeDateLevel("month",this.arrayRange),this.arrayRangeYear=this._changeDateLevel("year",this.arrayRange)}},_changeDateLevel:function(t,s){var a=[];return e.each(s,function(e,s){if(void 0===s.length){var i="";switch(t){case"month":i=new Date(s.getFullYear(),s.getMonth(),1,0,0,0,0);break;case"year":i=new Date(s.getFullYear(),0,1,0,0,0,0)}}else if(2===s.length){var i=[];switch(t){case"month":i[0]=new Date(s[0].getFullYear(),s[0].getMonth(),1,0,0,0,0),i[1]=new Date(s[1].getFullYear(),s[1].getMonth(),1,0,0,0,0);break;case"year":i[0]=new Date(s[0].getFullYear(),0,1,0,0,0,0),i[1]=new Date(s[1].getFullYear(),0,1,0,0,0,0)}}a.push(i)}),a},_updateDate:function(e){this.currentDate[e].setDate(1),this.currentDate[e].setHours(0,0,0,0),this.currentDay[e]=this.currentDate[e].getDate(),this.currentMonth[e]=this.currentDate[e].getMonth(),this.currentYear[e]=this.currentDate[e].getFullYear(),this.currentMonthDate[e]=new Date(this.currentYear[e],this.currentMonth[e],1,0,0,0,0),this.currentYearDate[e]=new Date(this.currentYear[e],0,1,0,0,0,0),"multiple"!==this.mode&&(this.selectedDay[e]=this.selectedDate[e].getDate(),this.selectedMonth[e]=this.selectedDate[e].getMonth(),this.selectedYear[e]=this.selectedDate[e].getFullYear(),this.selectedMonthDate[e]=new Date(this.selectedYear[e],this.selectedMonth[e],1,0,0,0,0),this.selectedYearDate[e]=new Date(this.selectedYear[e],0,1,0,0,0,0))},_inArray:function(t,s){return-1===e.inArray(t,s)?!1:!0},_stringSeparate:function(e,t){var s=RegExp("[.\\"+t+"\\s].*?"),t=e.match(s),a=e.split(t);return a},_parseHtmlString:function(e,s){var a=[],i=t.defaults;if("object"==typeof i[e]){for(var n,r=this._stringSeparate(s,","),h=0;r.length>h;h++)n=this._stringSeparate(r[h],">"),n=n.length>1?{from:n[0],to:n[1]}:n[0],a.push(n);return a}return s},_setDate:function(e,t,s){if("object"==typeof t)for(var a in t)switch(a){case"day":e.setDate(t[a]);break;case"month":e.setMonth(t[a]);break;case"year":e.setYear(t[a])}else switch(t){case"day":e.setDate(s);break;case"month":e.setMonth(s);break;case"year":e.setYear(s)}},_parseFormat:function(e){var t=e.match(/[.\/\-\s].*?/),s=e.split(/\W+/)||s;if(!s||0===s.length)throw Error("Invalid date format.");return{separator:t,parts:s}},_formatDate:function(e,t){var s={d:e.getDate(),m:e.getMonth()+1,yy:(""+e.getFullYear()).substring(2),yyyy:e.getFullYear()};s.dd=(10>s.d?"0":"")+s.d,s.mm=(10>s.m?"0":"")+s.m,e=[];for(var a=0,i=t.parts.length;i>a;a++)e.push(s[t.parts[a]]);return e.join(t.separator)},_parseDate:function(e,t){switch(typeof e){case"string":if(5>e.length){var s=new Date,a=s.getDate();s.setHours(0,0,0,0),s.setDate(a+Number(e))}else{var i,n=e.split(t.separator)||n,s=new Date;if(s.setHours(0,0,0,0),n.length===t.parts.length)for(var r=0,h=t.parts.length;h>r;r++){if(i=parseInt(n[r],10)||1,"1"===i)return;switch(t.parts[r]){case"dd":case"d":s.setDate(i);break;case"mm":case"m":s.setMonth(i-1);break;case"yy":s.setFullYear(2e3+i);break;case"yyyy":s.setFullYear(i)}}}break;case"number":var s=new Date,a=s.getDate();s.setHours(0,0,0,0),s.setDate(a+e)}return s},_parseAbleDate:function(e,t){for(var s=[],a=0,i=0;e.length>i;i++)if("string"==typeof e[i])s[a++]=this._parseDate(e[i],t);else if("object"==typeof e[i]){var n,r,h=e[i];for(var o in h)switch(o){case"from":n=h[o];break;case"to":r=h[o]}s[a++]=[this._parseDate(n,t),this._parseDate(r,t)]}return s},_parseAble:function(e){for(var t=[],s=0,a=0;e.length>a;a++)if("number"==typeof e[a])t[s++]=e[a];else if("string"==typeof e[a])t[s++]=Number(e[a]);else if("object"==typeof e[a]){var i,n,r=e[a];for(var h in r)switch(h){case"from":i=Number(r[h]);break;case"to":n=Number(r[h])}for(var o=i;n>=o;o++)t[s++]=o}return t},_position:function(){var e=(window.innerHeight,window.innerWidth,this.picker.outerHeight()),t=this.picker.outerWidth(),s=this.$el.offset().top,a=this.$el.offset().left,i=this.$el.outerHeight(),n=this.$el.outerWidth(),r=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,h=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,o=s-r,c=a-h;switch(this.options.position){case"top":this.picker.css({left:c+h,top:o-e+r});break;case"right":this.picker.css({left:c+n+h,top:o+r});break;case"bottom":this.picker.css({left:c+h,top:o+i+r});break;case"left":this.picker.css({left:c-t+h,top:o+r});break;case"rightTop":this.picker.css({left:c+n+h,top:o-e+i+r});break;case"leftTop":this.picker.css({left:c-t+h,top:o-e+i+r})}},_setPoint:function(e,t,s,a){var i=t;switch(e){case"=":s===a&&(i=!0);break;case"<":a>s&&(i=!0);break;case">":s>a&&(i=!0)}return i},_setSection:function(e,t,s,a){var i=e,n=Date.parse(t),r=Date.parse(s),h=Date.parse(a);return n>=r&&h>=n&&(i=!0),i},_setRange:function(t,s,a,i,n){var r=a,h=this;return"section"===t?r=this._inArray(i,n):"array"===t&&e.each(n,function(e,t){switch(t.length){case void 0:Date.parse(i)===Date.parse(t)&&(r=!0);break;case 2:r=h._setSection(r,i,t[0],t[1])}}),r},_judgeLock:function(e){var t,s,a=!1,i=!1;switch(this.mode){case"range":if(0===e){switch(this.views[e]){case"days":t=Date.parse(this.currentDate[e]),s=Date.parse(this.selectedMonthDate[1]);break;case"months":t=Date.parse(this.currentYearDate[e]),s=Date.parse(this.selectedYearDate[1]);break;case"years":t=new Date(this.currentYearDate[e]).setFullYear(this.currentYear[e]+4),s=Date.parse(this.selectedYearDate[1])}i=!this._setPoint("<",i,t,s)}else{switch(this.views[e]){case"days":t=Date.parse(this.currentDate[e]),s=Date.parse(this.selectedMonthDate[0]);break;case"months":t=Date.parse(this.currentYearDate[e]),s=Date.parse(this.selectedYearDate[0]);break;case"years":t=new Date(this.currentYearDate[e]).setFullYear(this.currentYear[e]+4),s=Date.parse(this.selectedYearDate[0])}a=!this._setPoint(">",a,t,s)}break;case"multiple":0===e?i=!0:a=e===this.options.calendars-1?!0:i=!0}a===!0?this.calendarPrevs.eq(e).addClass(this.namespace+"_blocked"):this.calendarPrevs.eq(e).removeClass(this.namespace+"_blocked"),i===!0?this.calendarNexts.eq(e).addClass(this.namespace+"_blocked"):this.calendarNexts.eq(e).removeClass(this.namespace+"_blocked")},_judgeRange:function(t,s,a){var i,n,r=s,h=this.options.rangeMode,o=this;if(isUntouch=!1,"section"===h){switch(t){case"days":i=this.daySection,n=a.getDay();break;case"months":i=this.monthSection,n=a.getMonth();break;case"years":i=this.yearSection,n=a.getFullYear()}r=this._inArray(n,i)}else if("array"===h){switch(t){case"days":i=this.arrayRange;break;case"months":i=this.arrayRangeMonth;break;case"years":i=this.arrayRangeYear}e.each(i,function(e,t){switch(t.length){case void 0:Date.parse(a)===Date.parse(t)&&(r=!0);break;case 2:r=o._setSection(r,a,t[0],t[1])}})}return r},_judgeStatus:function(e,t,s,a,i,n){var r=a[0],h=a[1],o=a[2];switch(s){case"single":h=this._setPoint("=",h,Date.parse(i),Date.parse(n[e]));break;case"range":h=this._setPoint("=",h,Date.parse(i),Date.parse(n[e])),o=this._setSection(o,i,n[0],n[1]),0===e?r=this._setPoint(">",r,Date.parse(i),Date.parse(n[1])):1===e&&(r=this._setPoint("<",r,Date.parse(i),Date.parse(n[0])));break;case"multiple":for(var c=0;this.selectedDate.length>c;c++)Date.parse(i)===n[c]&&(h=!0)}return a=[r,h,o]},_renderStatus:function(e){var t=e[0],s=e[1],a=e[2],i=e[3],n="";return i===!0?n=" "+this.namespace+"_untouchable":(t===!0&&(n=" "+this.namespace+"_untouchable"),a===!0&&(n+=" "+this.namespace+"_inRange")),s===!0&&(n+=" "+this.namespace+"_active"),n},_manageViews:function(e){switch(this.views[e]){case"days":this._generateDaypicker(e),this.calendars.eq(e).addClass(this.namespace+"_days"),this.calendars.eq(e).removeClass(this.namespace+"_months"),this.calendars.eq(e).removeClass(this.namespace+"_years");break;case"months":this._generateMonthpicker(e),this.calendars.eq(e).removeClass(this.namespace+"_days"),this.calendars.eq(e).addClass(this.namespace+"_months"),this.calendars.eq(e).removeClass(this.namespace+"_years");break;case"years":this._generateYearpicker(e),this.calendars.eq(e).removeClass(this.namespace+"_days"),this.calendars.eq(e).removeClass(this.namespace+"_months"),this.calendars.eq(e).addClass(this.namespace+"_years")}},_generateDaypicker:function(e){this._generateHeader(e,a[this.options.lang].months[this.currentMonth[e]]+" "+this.currentYear[e]),this.daypickers.eq(e).html(this._buildDays(e))},_generateMonthpicker:function(e){this._generateHeader(e,this.currentYear[e]),this.monthpickers.eq(e).html(this._buildMonths(e))},_generateYearpicker:function(e){this._generateHeader(e,this.currentYear[e]-7+this.options.rangeSeparator+(this.currentYear[e]+4)),this.yearpickers.eq(e).html(this._buildYears(e))},_generateHeader:function(e,t){this.calendarCaptions.eq(e).html(t),this._judgeLock(e)},_buildDays:function(e){var t,s,i,n,r,h,o,c=this.currentYear[e],l=this.currentMonth[e],u=new Date(c,l+1,0).getDate(),p=new Date(c,l,1).getDay(),d=new Date(c,l,0).getDate(),D=p-this.options.firstDayOfWeek,f='<div class="'+this.namespace+'-head">',m=[],g=[];D=0>D?7+D:D;for(var w=0;7>w;w++)f+="<span>"+a[this.options.lang].daysShort[w]+"</span>";f+='</div><div class="'+this.namespace+'-body"><div class="'+this.namespace+'-row">';for(var y=0;42>y;y++)t=y-D+1,i=!1,n=!1,s=!1,r=!1,m=[s,i,n,r],h=0,o="",y>0&&0===y%7&&(f+='</div><div class="'+this.namespace+'-row">'),D>y?(o=this.namespace+"_otherMonth",h=d-D+y+1,g[y]=new Date(c,l-1,h,0,0,0,0)):y>u+D-1?(o=this.namespace+"_otherMonth",h=t-u,g[y]=new Date(c,l+1,h,0,0,0,0)):(g[y]=new Date(c,l,t,0,0,0,0),h=t,"multiple"===this.mode?Date.parse(g[y])===Date.parse(this.focusDate)&&(o+=" "+this.namespace+"_focus"):Date.parse(g[y])===Date.parse(this.focusDate[e])&&(o+=" "+this.namespace+"_focus")),m=this._judgeStatus(e,"days",this.mode,m,g[y],this.selectedDate),m[3]=this._judgeRange("days",m[3],g[y]),("section"===this.options.rangeMode&&this.daySelectable===!0||"array"===this.options.rangeMode&&this.selectableDate===!0)&&(m[3]=!m[3]),o+=this._renderStatus(m),f+='<span class="'+o+'">'+h+"</span>";return f+="</div></div>"},_buildMonths:function(e){var t,s,i,n,r,h=this.currentYear[e],o="",c=a[this.options.lang].monthsShort,l=this.focusDate[e],u=[],p=[];o+='<div class="'+this.namespace+'-row">';for(var d=0;12>d;d++)s=!1,i=!1,n=!1,r=!1,p=[n,s,i,r],t="",d>0&&0===d%3&&(o+='</div><div class="'+this.namespace+'-row">'),u[d]=new Date(h,d,1,0,0,0,0),p=this._judgeStatus(e,"months",this.mode,p,u[d],this.selectedMonthDate),p[3]=this._judgeRange("months",p[3],u[d]),("section"===this.options.rangeMode&&this.monthSelectable===!0||"array"===this.options.rangeMode&&this.selectableDate===!0)&&(p[3]=!p[3]),Date.parse(u[d])===Date.parse(new Date(l.getFullYear(),l.getMonth(),1,0,0,0,0))&&(t+=" "+this.namespace+"_focus"),t+=this._renderStatus(p),o+='<span class="month-'+d+" "+t+'">'+c[d]+"</span>";return o+="</div>"},_buildYears:function(e){var t,s,a,i,n,r=this.currentYear[e],h="",o=0,c=[],l=this.focusDate[e],u=[];h+='<div class="'+this.namespace+'-row">';for(var p=0;12>p;p++)s=!1,a=!1,i=!1,n=!1,u=[i,s,a,n],t="",o=r-7+p,p>0&&0===p%3&&(h+='</div><div class="'+this.namespace+'-row">'),c[p]=new Date(o,0,1,0,0,0,0),u=this._judgeStatus(e,"years",this.mode,u,c[p],this.selectedYearDate),u[3]=this._judgeRange("years",u[3],c[p]),("section"===this.options.rangeMode&&this.yearSelectable===!0||"array"===this.options.rangeMode&&this.selectableDate===!0)&&(u[3]=!u[3]),Date.parse(c[p])===Date.parse(new Date(l.getFullYear(),0,1,0,0,0,0))&&(t+=" "+this.namespace+"_focus"),t+=this._renderStatus(u),h+='<span class="'+t+'">'+o+"</span>";return h+="</div>"},_click:function(t){if(0===e(t.target).closest(this.picker).length&&0===e(t.target).closest(this.$el).length&&this.options.alwaysShow===!1)this.hide();else if(1!==e(t.target).closest(this.$el).length&&1===e(t.target).closest(this.picker).length){var s=e(t.target).closest("span");if(1===s.length){var a=s.parents("."+this.namespace+"-content").index();switch(s[0].className){case this.namespace+"-caption":this._changeView("caption",a),this._manageViews(a);break;case this.namespace+"-prev":this.prev(a);break;case this.namespace+"-next":this.next(a);break;default:if(s.hasClass(this.namespace+"_otherMonth")||s.hasClass(this.namespace+"_untouchable")||s.hasClass(this.namespace+"_blocked")||1===s.parents("."+this.namespace+"-head").length)return!1;this._changeValue(s,a),"days"===this.views[a]&&"single"===this.mode&&(this.selected=!0),this._changeView("content",a),this._updateDate(a),"range"===this.mode?(this._manageViews(0),this._manageViews(1)):"multiple"===this.mode?(this._manageViews(a-1),this._manageViews(a),this._manageViews(a+1)):"single"===this.mode&&this._manageViews(a),this._setValue()}}this.selected===!0&&this.options.alwaysShow===!1&&"single"===this.mode&&this.options.onceClick===!0?this.hide():"dropdown"===this.options.displayMode&&this.$el.focus()}},_changeView:function(e,t){switch(e){case"caption":if("multiple"===this.options.mode)return!1;if("days"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="years"}break;case"content":if("years"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="days"}break;case"higher":if("multiple"===this.options.mode)return!1;if("days"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="years"}break;case"lower":if("multiple"===this.options.mode)return!1;if("years"===this.views[t])this.views[t]="months";else{if("months"!==this.views[t])return!1;this.views[t]="days"}}},_changeValue:function(t,s){var a="",i="",n=this;switch(this.views[s]){case"years":a=parseInt(t.text(),10),this.currentDate[s].setYear(a);break;case"months":a=Number(t.attr("class").match(/month\-([0-9]+)/)[1]),this.currentDate[s].setMonth(a);break;case"days":switch(a=parseInt(t.text(),10),i=new Date(this.currentYear[s],this.currentMonth[s],a,0,0,0,0),this.options.mode){case"single":case"range":this.selectedDate[s]=i;break;case"multiple":var r=Date.parse(i);e.inArray(r,this.selectedDate)>-1?e.each(this.selectedDate,function(e,t){return t===r?(n.selectedDate.splice(e,1),!1):void 0}):this.selectedDate.length<this.options.multipleSelectNum&&this.selectedDate.push(r)}}},_setValue:function(){switch(this.mode){case"single":var e=this._formatDate(this.selectedDate[0],this.outputFormat);this.$el.val(e);break;case"range":var t=this._formatDate(this.selectedDate[0],this.outputFormat),s=this._formatDate(this.selectedDate[1],this.outputFormat);this.$el.val(t+this.options.rangeSeparator+s);break;case"multiple":for(var e,a="",i=0;this.selectedDate.length>i;i++)e=this._formatDate(new Date(this.selectedDate[i]),this.outputFormat),a+=0===a.length?e:this.options.multipleSeparator+e;this.$el.val(a)}this.options.onChange&&this.options.onChange.apply(this),this.oldValue=this.$el.val()},_focus:function(){"dropdown"===this.options.displayMode&&this.showed===!1&&this.show(),this.options.keyboard&&this._keyboard.init(this)},_blur:function(){return"dropdown"===this.options.displayMode&&this.pickerHide===!0&&(this.hide(),this.pickerHide=!1),this.options.keyboard&&this._keyboard.destroy(this),!1},show:function(){var e=this;return"inline"===this.options.displayMode?(this.options.onBeforeShow&&this.options.onBeforeShow.apply(this),this.picker.on("click.picker",function(t){e._click.call(e,t)})):this.showed===!1&&(this.options.onBeforeShow&&this.options.onBeforeShow.apply(this),this.picker.removeClass(this.namespace+"_hide"),this.picker.addClass(this.namespace+"_show"),this._position(),this.showed=!0,s.on("click."+this.flag,function(t){e._click.call(e,t)})),this.options.onShow&&this.options.onShow.apply(this),this},hide:function(){return this.showed===!0&&(this.options.onBeforeHide&&this.options.onBeforeHide.apply(this),this.selected=!1,this.picker.removeClass(this.namespace+"_show"),this.picker.addClass(this.namespace+"_hide"),this.showed=!1,s.off("click."+this.flag),this.options.onHide&&this.options.onHide.apply(this)),this},prev:function(e,t){var s=this.currentDate[e];switch(this.views[e]){case"days":if("multiple"===this.mode){if(t)if(0===this.focused)for(var a=0;this.options.calendars>a;a++)this.currentDate[a].setMonth(this.currentMonth[a]-1),this._updateDate(a),this._manageViews(a);else--this.focused,this._manageViews(e),this._manageViews(e-1),console.log(this.focused);else{var i=new Date(s.getFullYear(),s.getMonth(),0).getDate();this.focusDate.getDate()>i&&this.focusDate.setDate(i),this.focusDate.setMonth(this.focusDate.getMonth()-1);for(var n=0;this.options.calendars>n;n++)this.currentDate[n].setMonth(this.currentMonth[n]-1),this._updateDate(n),this._manageViews(n)}return!1}if(s.setMonth(this.currentMonth[e]-1),t){var i=new Date(s.getFullYear(),s.getMonth(),0).getDate();this.focusDate[e].getDate()>i&&this.focusDate[e].setDate(i),this.focusDate[e]=new Date(s.getFullYear(),s.getMonth(),this.focusDate[e].getDate(),0,0,0,0)}break;case"months":s.setYear(this.currentYear[e]-1),t&&(this.focusDate[e]=new Date(s.getFullYear(),this.focusDate[e].getMonth(),this.focusDate[e].getDate(),0,0,0,0));break;case"years":s.setYear(this.currentYear[e]-12)}this._updateDate(e),this._manageViews(e)},next:function(e,t){var s=this.currentDate[e];switch(this.views[e]){case"days":if("multiple"===this.mode){if(t)if(this.focused===this.options.calendars-1)for(var a=0;this.options.calendars>a;a++)this.currentDate[a].setMonth(this.currentMonth[a]+1),this._updateDate(a),this._manageViews(a);else++this.focused,this._manageViews(e),this._manageViews(e+1);else{var i=new Date(s.getFullYear(),s.getMonth()+2,0).getDate();this.focusDate.getDate()>i&&this.focusDate.setDate(i),this.focusDate.setMonth(this.focusDate.getMonth()+1);for(var n=0;this.options.calendars>n;n++)this.currentDate[n].setMonth(this.currentMonth[n]+1),this._updateDate(n),this._manageViews(n)}return!1}if(s.setMonth(this.currentMonth[e]+1),t){var i=new Date(s.getFullYear(),s.getMonth()+1,0).getDate();this.focusDate[e].getDate()>i&&this.focusDate[e].setDate(i),this.focusDate[e]=new Date(s.getFullYear(),s.getMonth(),this.focusDate[e].getDate(),0,0,0,0)}break;case"months":s.setYear(this.currentYear[e]+1),t&&(this.focusDate[e]=new Date(s.getFullYear(),this.focusDate[e].getMonth(),this.focusDate[e].getDate(),0,0,0,0));break;case"years":s.setYear(this.currentYear[e]+12)}this._updateDate(e),this._manageViews(e)},multipleClear:function(){this.selectedDate=[];for(var e=0;this.options.calendars>e;e++)this.manageViews(e);this._setValue()},getWrap:function(){return this.picker},getInput:function(){return this.$el},getDate:function(e){if(void 0===e)return this.selectedDate;for(var t=this._parseFormat(e),s=[],a=0;this.selectedDate.length>a;a++)s[a]=this._formatDate(this.selectedDate[a],t);return s},destroy:function(){this.$el.removeData("datepicker"),this.picker.remove(),"inline"===this.options.displayMode?this.picker.off("click.picke"):s.off("click."+this.flag),this.$el.off("focus"),this.$el.off("blur")
},update:function(e){if(e!==void 0)for(var t in e)this.options[t]=e[t];this.destroy(),this._init()}},e.fn.datepicker=function(s){if("string"!=typeof s)return this.each(function(){e.data(this,"datepicker")||e.data(this,"datepicker",new t(this,s))});var a=s,i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;if(/^\_/.test(a))return!1;if(!/^(getWrap|getInput|getDate)$/.test(a))return this.each(function(){var t=e.data(this,"datepicker");t&&"function"==typeof t[a]&&t[a].apply(t,i)});var n=this.first().data("datepicker");return n&&"function"==typeof n[a]?n[a].apply(n,i):void 0}})(jQuery);