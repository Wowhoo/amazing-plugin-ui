/*! jQuery asTooltip - v0.2.0 - 2014-06-11
* https://github.com/amazingSurge/jquery-asTooltip
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a){"use strict";function b(a,b,c,d,e,f){var g,h,i,j=0,k=0;switch(f?(g=a,h=0,i=0):(g=a.offset(),h=a.outerWidth(),i=a.outerHeight()),b){case"n":j=g.left+h/2-c/2,k=g.top-d-e;break;case"e":j=g.left+h+e,k=g.top+i/2-d/2;break;case"s":j=g.left+h/2-c/2,k=g.top+i+e;break;case"w":j=g.left-c-e,k=g.top+i/2-d/2;break;case"nw":case"wn":j=g.left-c+20,k=g.top-d-e;break;case"ne":case"en":j=g.left+h-20,k=g.top-d-e;break;case"sw":case"ws":j=g.left-c+20,k=g.top+i+e;break;case"se":case"es":j=g.left+h-20,k=g.top+i+e}return{left:Math.round(j),top:Math.round(k)}}function c(a,b){var c,e,f=d.scrollLeft(),g=d.scrollTop(),h=a.offset(),i=a.outerWidth(!0),j=a.outerHeight(!0),k=d.width(),l=d.height(),m=[];return b?(c=b.outerWidth(!0),e=b.outerHeight(!0)):(c=100,e=50),h.top<g+e&&m.push("n"),h.top+j+e>g+l&&m.push("s"),h.left<f+c&&m.push("w"),h.left+i+c>f+k&&m.push("e"),m}var d=a(window),e=!1,f=[],g="nswe",h={n:{n:"s",w:"ne",e:"nw"},s:{s:"n",w:"se",e:"sw"},w:{w:"e",n:"sw",s:"nw"},e:{e:"w",n:"se",s:"ne"},nw:{n:"sw",w:"ne"},ne:{n:"se",e:"nw"},sw:{s:"nw",w:"se"},se:{s:"ne",e:"sw"}},i=a.asTooltip=function(b,c){this.$element=a(b),this.options=a.extend({},i.defaults,c,this.$element.data()),this.namespace=this.options.namespace,this.content=null,this.$target=this.$element,this.isOpen=!1,this.enabled=!0,this.tolerance=null,this.onlyOne=this.options.onlyOne,this._trigger("init"),this.init()};i.prototype={constructor:i,init:function(){var b=this.parseTpl(this.options.tpl);this.$container=a(b.container),this.$loading=a(b.loading),this.$arrow=a(b.arrow),this.$close=a(b.close),this.$content=a(b.content),"hover"===this.options.trigger&&(this.$target.on("mouseenter.asTooltip",this.options.selector,a.proxy(this.enter,this)),this.$target.on("mouseleave.asTooltip",this.options.selector,a.proxy(this.leave,this)),this.options.mouseTrace===!0&&this.$target.on("mousemove.asTooltip",this.options.selector,a.proxy(this.move,this))),"click"===this.options.trigger&&this.$target.on("click.asTooltip",this.options.selector,a.proxy(this.toggle,this)),this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle(),f.push(this),this._trigger("ready")},getDelegateOptions:function(){var b={};return this._options&&a.each(this._options,function(a,c){i.defaults[a]!==c&&(b[a]=c)}),b},fixTitle:function(){this.$element.attr("title")&&(this.options.title=this.$element.attr("title"),this.$element.removeAttr("title"))},enter:function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("asTooltip");return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("asTooltip",c)),c.isOpen===!0?void clearTimeout(c.tolerance):void a.proxy(c.show,c)()},leave:function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("asTooltip");if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("asTooltip",c)),c.options.interactive===!0){var d=!1;c.$container.on("mouseenter.asTooltip",function(){d=!0}),c.$container.on("mouseleave.asTooltip",function(){d=!1}),clearTimeout(c.tolerance),c.tolerance=setTimeout(function(){d===!0?c.$container.on("mouseleave.asTooltip",a.proxy(c.hide,c)):a.proxy(c.hide,c)()},c.options.interactiveDelay)}else a.proxy(c.hide,c)()},toggle:function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("asTooltip");c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("asTooltip",c)),c.isOpen===!0?a.proxy(c.hide,c)():a.proxy(c.show,c)()},move:function(c){var d,e={},f=c.pageX,g=c.pageY,h=c instanceof this.constructor?c:a(c.currentTarget).data("asTooltip");h||(h=new this.constructor(c.currentTarget,this.getDelegateOptions()),a(c.currentTarget).data("asTooltip",h)),e={top:g,left:f},d=b(e,h.options.position,h.width,h.height,h.options.popSpace,!0),h.$container.css({display:"block",top:d.top,left:d.left})},load:function(){var b=this,c=this.options;c.ajax===!0?a.ajax(a.extend({},c.ajaxSettings,{url:c.title,error:function(){throw new Error("ajax error")},success:function(a,c){"success"===c&&(b.content=a,b.$container.css({display:"none"}),b.$content.empty().append(b.content),b.$container.removeClass(b.posCss),b.setPosition())}})):this.content=c.inline===!0?-1!==c.title.indexOf("+")?this.$element.next().css({display:"block"}):a(c.title).css({display:"block"}):c.title},parseTpl:function(b){var c={},d=this;return a.each(b,function(a,b){c[a]=b.replace("{{namespace}}",d.namespace)}),c},showLoading:function(){this.$content.empty(),this.$loading.css({display:"block"})},hideLoading:function(){this.$loading.css({display:"none"})},setPosition:function(){var d,e=this.options,f=this.namespace+"-"+e.position;if(this.width=this.$container.outerWidth(),this.height=this.$container.outerHeight(),e.mouseTrace!==!0){if(e.autoPosition===!0){var i,j=[];if(j=e.ajax===!0&&null===this.content?c(this.$target):c(this.$target,this.$container),0===j.length)i=e.position;else if(1===j.length){var k=h[e.position][j[0]];i=void 0===k?e.position:k}else{var l=g;a.each(j,function(a,b){l.replace(b,"")}),i=l}f=this.namespace+"-"+i,d=b(this.$target,i,this.width,this.height,this.options.popSpace)}else d=b(this.$target,e.position,this.width,this.height,this.options.popSpace);this.$container.css({display:"block",top:d.top,left:d.left})}this.posCss=f,this.$container.addClass(f)},_trigger:function(a){this.$element.trigger("asColorInput::"+a,this),this.$element.trigger(a+".asColorInput",this),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;"function"==typeof this.options[b]&&this.options[b].apply(this,c)},show:function(){var b=this.options,c=this;if(this.enabled)return this.onlyOne&&a.each(f,function(a,b){b!==c&&b.isOpen&&b.hide()}),this.$container=a(this.options.tpl.container),b.closeBtn&&this.$container.append(this.$close),this.$container.append(this.$arrow).append(this.$content),this.$element.addClass(this.namespace+"_active"),null===this.content&&this.load(),null===this.content?this.$content.append(this.$loading):this.$content.empty().append(this.content),b.skin&&this.$container.addClass(this.namespace+"_"+b.skin),this.$container.css({display:"none",top:0,left:0,position:"absolute",zIndex:99990}),this.options.container?this.$container.appendTo(this.options.container):this.$container.insertAfter(this.$element),this.setPosition(),this._trigger("show"),this.isOpen=!0,this},hide:function(){this.$container.off(".asTooltip"),this._trigger("hide"),this.$element.removeClass(this.namespace+"_active"),this.$container.remove(),this.isOpen=!1,e=!1},setContent:function(a){this.content=a},enable:function(){return this.enabled=!0,this.$element.addClass(this.namespace+"-enabled"),this},disable:function(){return this.enabled=!1,this.$element.removeClass(this.namespace+"-enabled"),this},destroy:function(){this.$target.off(".asTooltip")}},i.closeAll=function(){f.map(function(a){a.isOpen&&a.hide()})},i.defaults={namespace:"asTooltip",skin:null,onlyOne:!1,trigger:"hover",interactive:!1,interactiveDelay:500,mouseTrace:!1,closeBtn:!1,selector:!1,container:"body",popSpace:10,position:"n",autoPosition:!0,delay:0,effect:"fade",duration:200,inline:!1,content:null,ajax:!1,ajaxSettings:{dataType:"html",headers:{tooltip:!0}},onShow:null,onHide:null,onUpdate:null,tpl:{container:'<div class="{{namespace}}"></div>',loading:'<span class="{{namespace}}-loading"></span>',content:'<div class="{{namespace}}-content"></div>',arrow:'<span class="{{namespace}}-arrow"></span>',close:'<a class="{{namespace}}-close"></a>'}},a.fn.asTooltip=function(b){if("string"==typeof b){var c=b,d=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var b=a.data(this,"asTooltip");"function"==typeof b[c]&&b[c].apply(b,d)})}return this.each(function(){a.data(this,"asTooltip")||a.data(this,"asTooltip",new i(this,b))})}}(jQuery);