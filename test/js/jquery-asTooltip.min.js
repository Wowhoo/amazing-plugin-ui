/*! jQuery asTooltip - v0.1.0 - 2014-03-28
* https://github.com/amazingSurge/jquery-asTooltip
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(t){"use strict";function e(t,e,n,s,i,o){var a,r,l,c=0,h=0;switch(o?(a=t,r=0,l=0):(a=t.offset(),r=t.outerWidth(),l=t.outerHeight()),e){case"n":c=a.left+r/2-n/2,h=a.top-s-i;break;case"e":c=a.left+r+i,h=a.top+l/2-s/2;break;case"s":c=a.left+r/2-n/2,h=a.top+l+i;break;case"w":c=a.left-n-i,h=a.top+l/2-s/2;break;case"nw":case"wn":c=a.left-n+20,h=a.top-s-i;break;case"ne":case"en":c=a.left+r-20,h=a.top-s-i;break;case"sw":case"ws":c=a.left-n+20,h=a.top+l+i;break;case"se":case"es":c=a.left+r-20,h=a.top+l+i}return{left:Math.round(c),top:Math.round(h)}}function n(t,e){var n,s,i=o.scrollLeft(),a=o.scrollTop(),r=t.offset(),l=t.outerWidth(!0),c=t.outerHeight(!0),h=o.width(),p=o.height(),u=[];return e?(n=e.outerWidth(!0),s=e.outerHeight(!0)):(n=100,s=50),a+s>r.top&&u.push("n"),r.top+c+s>a+p&&u.push("s"),i+n>r.left&&u.push("w"),r.left+l+n>i+h&&u.push("e"),u}function s(){var t=document.body||document.documentElement,e=t.style,n="transition";if("string"==typeof e[n])return!0;i=["Moz","Webkit","Khtml","O","ms"],n=n.charAt(0).toUpperCase()+n.substr(1);for(var s=0;i.length>s;s++)if("string"==typeof e[i[s]+n])return!0;return!1}var i,o=t(window),a=!1,r=[],l="nswe",c={n:{n:"s",w:"ne",e:"nw"},s:{s:"n",w:"se",e:"sw"},w:{w:"e",n:"sw",s:"nw"},e:{e:"w",n:"se",s:"ne"},nw:{n:"sw",w:"ne"},ne:{n:"se",e:"nw"},sw:{s:"nw",w:"se"},se:{s:"ne",e:"sw"}},h=!0;s()||(h=!1);var p=t.asTooltip=function(e,n){var s={};this.$elem=t(e),t.each(this.$elem.data(),function(t,e){/^asTooltip/i.test(t)&&(s[t.toLowerCase().replace(/^asTooltip/i,"")]=e)}),this.options=t.extend({},p.defaults,n,s),this.namespace=this.options.namespace,this.$elem.attr("title")&&(this.options.title=this.$elem.attr("title"),this.$elem.removeAttr("title")),this.content=null,this.target=this.options.target||this.$elem,this.isOpen=null,this.enabled=!0,this.tolerance=null,this.onlyOne=this.options.onlyOne||!1,this.init()};p.prototype={constructor:p,init:function(){var n=this.options,s=this;n.tpl=this.parseTpl(n.tpl),this.$container=t(n.tpl.container),this.$loading=t(n.tpl.loading),this.$arrow=t(n.tpl.arrow),this.$close=t(n.tpl.close),this.$content=t(n.tpl.content),"hover"===n.trigger&&(this.target.on("mouseenter.asTooltip",function(){return s.isOpen===!0?(clearTimeout(this.tolerance),void 0):(t.proxy(s.show,s)(),void 0)}),n.interactive===!0?this.target.on("mouseleave.asTooltip",function(){var e=!1;s.$container.on("mouseenter.asTooltip",function(){e=!0}),s.$container.on("mouseleave.asTooltip",function(){e=!1}),clearTimeout(this.tolerance),this.tolerance=setTimeout(function(){e===!0?s.$container.on("mouseleave.asTooltip",t.proxy(s.hide,s)):t.proxy(s.hide,s)()},s.options.interactiveDelay)}):this.target.on("mouseleave.asTooltip",t.proxy(s.hide,s)),this.options.mouseTrace===!0&&this.target.on("mousemove.asTooltip",function(t){var n,i={},o=t.pageX,a=t.pageY;i={top:a,left:o},n=e(i,s.options.position,s.width,s.height,s.options.popSpace,!0),s.$container.css({display:"block",top:n.top,left:n.left})})),"click"===n.trigger&&this.target.on("click.asTooltip",function(){s.isOpen===!0?t.proxy(s.hide,s)():t.proxy(s.show,s)()}),r.push(this)},load:function(){var e=this,n=this.options;n.ajax===!0?t.ajax(t.extend({},n.ajaxSettings,{url:n.title,error:function(){throw Error("ajax error")},success:function(t,n){"success"===n&&(e.content=t,e.$container.css({display:"none"}),e.$content.empty().append(e.content),e.$container.removeClass(e.posCss),e.setPosition())}})):this.content=n.inline===!0?-1!==n.title.indexOf("+")?this.$elem.next().css({display:"block"}):t(n.title).css({display:"block"}):n.title},parseTpl:function(e){var n={},s=this;return t.each(e,function(t,e){n[t]=e.replace("{{namespace}}",s.namespace)}),n},showLoading:function(){this.$content.empty(),this.$loading.css({display:"block"})},hideLoading:function(){this.$loading.css({display:"none"})},setPosition:function(){var s,i=this.options,o=this.namespace+"-"+i.position;if(this.width=this.$container.outerWidth(),this.height=this.$container.outerHeight(),i.mouseTrace!==!0){if(i.autoPosition===!0){var a,r=[];if(r=i.ajax===!0&&null===this.content?n(t(this.target)):n(t(this.target),this.$container),0===r.length)a=i.position;else if(1===r.length){var h=c[i.position][r[0]];a=void 0===h?i.position:h}else{var p=l;t.each(r,function(t,e){p.replace(e,"")}),a=p}o=this.namespace+"-"+a,s=e(this.target,a,this.width,this.height,this.options.popSpace)}else s=e(this.target,i.position,this.width,this.height,this.options.popSpace);this.$container.css({display:"block",top:s.top,left:s.left})}else this.$container.addClass("pointer-events-none");this.posCss=o,this.$container.addClass(o)},show:function(){var e=this.options,n=this;if(this.enabled!==!1)return this.onlyOne===!0&&t.each(r,function(t,e){e!==n&&e.isOpen===!0&&e.hide()}),e.closeBtn===!0&&this.$container.append(this.$close),this.$container.append(this.$arrow).append(this.$content),this.$elem.addClass(this.namespace+"_active"),null===this.content&&this.load(),null===this.content?this.$content.append(this.$loading):this.$content.empty().append(this.content),null!==e.skin&&this.$container.addClass(this.namespace+"_"+e.skin),this.$container.css({display:"none",top:0,left:0,position:"absolute",zIndex:99990}).appendTo(t("body")),this.setPosition(),"function"===e.onShow&&e.onShow(this.$elem),this.$container.trigger("show"),this.isOpen=!0,this},hide:function(){this.$container.off(".asTooltip"),this.$container.trigger("hide"),this.$elem.removeClass(this.namespace+"_active"),this.$container.remove(),this.$container.removeClass(this.posCss),"function"===this.options.onHide&&this.options.onHide(this.$elem),this.isOpen=!1,a=!1},setContent:function(t){this.content=t},enable:function(){return this.enabled=!0,this.container.addClass(this.namespace+"-enabled"),this},disable:function(){return this.enabled=!1,this.container.removeClass(this.namespace+"-enabled"),this},destroy:function(){this.target.off(".asTooltip")}},p.defaults={namespace:"asTooltip",skin:null,target:null,trigger:"hover",interactive:!1,interactiveDelay:500,mouseTrace:!1,closeBtn:!1,popSpace:10,position:"n",autoPosition:!0,delay:0,effect:"fade",duration:200,inline:!1,content:null,ajax:!1,ajaxSettings:{dataType:"html",headers:{asTooltip:!0}},onShow:null,onHide:null,onUpdate:null,tpl:{container:'<div class="{{namespace}}-container"></div>',loading:'<span class="{{namespace}}-loading"></span>',content:'<div class="{{namespace}}-content"></div>',arrow:'<span class="{{namespace}}-arrow"></span>',close:'<a class="{{namespace}}-close"></a>'}},t.fn.asTooltip=function(e){if("string"==typeof e){var n=e,s=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var e=t.data(this,"asTooltip");"function"==typeof e[n]&&e[n].apply(e,s)})}return this.each(function(){t.data(this,"asTooltip")||t.data(this,"asTooltip",new p(this,e))})}})(jQuery);