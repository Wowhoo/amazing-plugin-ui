/*! jQuery asUnitInput - v0.1.0 - 2014-05-16
* https://github.com/amazingSurge/jquery-asUnitInput
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(t){var s=t.asUnitInput=function(i,e){this.element=i,this.$element=t(i);var n=[];t.each(this.$element.data(),function(t,s){var i=RegExp("^asUnitInput","i");i.test(t)&&(n[t.toLowerCase().replace(i,"")]=s)}),this.name=this.$element.attr("name")?this.$element.attr("name"):e.name,this.options=t.extend({},s.defaults,e,n),this.namespace=this.options.namespace,this.disabled=this.options.disabled,this.unit=this.options.unit||"--",this.value=""===this.options.value?this.$element.attr("placeholder")||"":this.options.value,this.opened=!1,this.eventBinded=!1,this.isFocused=!1,this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",show:this.namespace+"_show",selected:this.namespace+"_selected",focus:this.namespace+"_focus",active:this.namespace+"_active",wrapAictive:this.namespace+"_wrapActive",mask:this.namespace+"-mask",wrap:this.namespace+"-wrap",select:this.namespace+"-select",mockInput:this.namespace+"-mockInput",input:this.namespace+"-input",unit:this.namespace+"-unit",trigger:this.namespace+"-trigger",unitText:this.namespace+"-unitText",dropdownIcon:this.namespace+"-dropdownIcon"},this._trigger("init"),this.init()};s.prototype={constructor:s,init:function(){var s=this;this.$element.addClass(this.classes.input),this.$element.wrap(t("<div></div>").addClass(this.classes.wrap)),this.$wrap=this.$element.parent(),this.$mockInput=t("<div></div>").addClass(this.classes.mockInput),this.$unit=t("<div></div>").addClass(this.classes.unit),this.$trigger=t("<div><span></span><i></i></div>").addClass(this.classes.trigger).appendTo(this.$unit),this.$select=t("<ul></ul>").addClass(this.classes.select).appendTo(this.$unit),this.$unitText=this.$trigger.find("span").addClass(this.classes.unitText),this.$dropdownIcon=this.$trigger.find("i").addClass(this.classes.dropdownIcon),this.options.skin&&this.$wrap.addClass(this.options.skin),t.each(this.options.units,function(i,e){var n=t("<li>"+e+"</li>").data("unit",i);s.unit===i&&n.addClass(s.classes.selected),n.appendTo(s.$select)}),this.$options=this.$select.find("li"),this.$mockInput.appendTo(this.$wrap),this.$unit.appendTo(this.$wrap),this.bindEvent(),this.$unitText.text(this.unit),this.$mockInput.addClass(this.classes.focus).text(this.value),this._trigger("ready")},position:function(){var s,i=this.$unit.outerHeight(!0),e=this.$unit.offset(),n=this.$select.height();s=n+e.top>t(window).height()+t(window).scrollTop()?-n:i,this.$select.css({position:"absolute",top:s,left:0})},setUnit:function(s){var i=this;return this.unit===s?(this.hide(),void 0):(t.each(this.$options,function(e,n){var a=t(n).data("unit");a===s?(t(n).addClass(i.classes.selected),i.$unitText.text(t(n).text()),i._trigger("unitChange",s),i._trigger("change",i.value,s)):t(n).removeClass(i.classes.selected)}),this.unit=s,this.hide(),void 0)},setValue:function(t){this.value!==t&&(this.value=t,this.$mockInput.text(t),this.$element.val(t),this._trigger("valueChange",this.value),this._trigger("change",this.value,this.unit))},getUnit:function(){return this.value},getValue:function(){return this.$element.val()},bindEvent:function(){var s=this;this.$wrap.attr("tabindex","0").on("focus.asUnitInput",function(){s.$wrap.addClass(s.classes.wrapAictive),s.isFocused=!0}).on("blur.asUnitInput",function(){s.isFocused=!1,setTimeout(function(){s.isFocused||s.$wrap.removeClass(s.classes.wrapAictive)},0)}),this.$element.on("focus.asUnitInput",function(){var i=this;s.isFocused=!0,t(document).on("keydown.asUnitInput",function(t){var e;return"function"==typeof s.options.beforeInput&&(e=s.options.beforeInput(t))?!1:(setTimeout(function(){s.value=i.value,s._trigger("valueChange",s.value),s._trigger("change",s.value,s.unit)},0),void 0)})}).on("blur.asUnitInput",function(){s.isFocused=!1,t(document).off(".asUnitInput"),setTimeout(function(){s.isFocused||s.$wrap.removeClass(s.classes.wrapAictive)},0)}),this.$trigger.on("click.asUnitInput",function(){s.opened?s.hide.call(s):s.show.call(s),s.isFocused=!0}),this.$mockInput.on("click.asUnitInput",function(){s.$element.one("blur.asUnitInput",function(){s.value=this.value,t(this).removeClass(s.classes.focus),s.$mockInput.text(this.value).addClass(s.classes.focus),t(this).val(s.options.format(s.value,s.unit))}).val(s.value).addClass(s.classes.focus).focus(),t(this).removeClass(s.classes.focus)}),this.$select.on("click.asUnitInput","li",function(){var i=t(this).data("unit");return s.setUnit.call(s,i),!1}),this.eventBinded=!0},unbindEvent:function(){this.$element.off(".asUnitInput"),this.$trigger.off(".asUnitInput"),this.$select.off(".asUnitInput"),this.$mockInput.off(".asUnitInput"),this.eventBinded=!1},_trigger:function(t){this.$element.trigger("asUnitInput::"+t,this),this.$element.trigger(t+".asUnitInput",this),t=t.replace(/\b\w+\b/g,function(t){return t.substring(0,1).toUpperCase()+t.substring(1)});var s="on"+t,i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;"function"==typeof this.options[s]&&this.options[s].apply(this,i)},show:function(){var s=this;if(this.disbaled!==!0)return this.$select.addClass(this.classes.show),this.$trigger.addClass(this.classes.active),this.$mask=t("<div></div>").addClass(this.classes.mask).on("click.asUnitInput",function(){return s.hide(),!1}),this.$wrap.after(this.$mask),this.opened=!0,this._trigger("show"),this},hide:function(){return this.$select.removeClass(this.classes.show),this.$trigger.removeClass(this.classes.active),this.$mask.off("click.asUnitInput").remove(),this.opened=!1,this._trigger("hide"),this},val:function(t){return t?(t.value&&this.setValue(t.value),t.unit&&this.setUnit(t.unit),void 0):this.$element.val()+this.unit},enable:function(){return this.disbaled=!1,this.$wrap.removeClass(this.classes.disbaled),this.eventBinded===!1&&this.bindEvent(),this},disable:function(){return this.disbaled=!0,this.$wrap.addClass(this.classes.disbaled),this.eventBinded===!0&&this.unbindEvent(),this},destroy:function(){this.unbindEvent(),this.$element.unwrap(),this.$unit.remove(),this.$mockInput.remove()}},s.defaults={namespace:"asUnitInput",skin:null,disbaled:!1,units:{px:"px",em:"em",rem:"rem"},name:null,unit:"px",value:"please",beforeInput:function(){},parse:function(){return{value:"",unit:""}},format:function(t,s){return t+s}},t.fn.asUnitInput=function(i){if("string"==typeof i){var e=i,n=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var s=t.data(this,"asUnitInput");"function"==typeof s[e]&&s[e].apply(s,n)})}return this.each(function(){t.data(this,"asUnitInput")||t.data(this,"asUnitInput",new s(this,i))})}})(jQuery);